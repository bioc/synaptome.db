---
title: "Untitled"
author: "Oksana Sorokina"
date: "2022-10-13"
output:
  pdf_document:
    keep_tex: yes
    number_sections: yes
  html_document: default
header-includes:
- \usepackage[T2A]{fontenc}
- \usepackage[utf8]{inputenc}
- \usepackage[english,russian]{babel}
- \usepackage{grffile}
- \usepackage{rotating}
- \usepackage{caption}
- \usepackage{longtable}
- \usepackage{lscape}
---
```{r loadPackages, include=FALSE, cache=FALSE}
## load additional packages in this chunk
library(synaptome.ldb)
library(ggplot2)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r comp_table}
gp<-findGeneByCompartmentPaperCnt(1)

```

```{r pre_histogram,fig.width=8,fig.height=8}
# presynaptic stats
presgp <- gp[gp$Localisation == "Presynaptic",]

syngp <- gp[gp$Localisation == "Synaptosome",]
presg <- getGeneInfoByIDs(presgp$GeneID)
#mpres <- merge(presgp, presg, by = "GeneID")
mpres <- merge(presgp, presg, by = c("GeneID","Localisation"))
#mmpres <- mpres[, c(1,3,6, 10, 17, 18, 19)]
mmpres <- mpres[, c('GeneID','HumanEntrez.x','HumanName.x','Npmid','PaperPMID','Paper','Year')]
head(mmpres)
papers <- getPapers()

prespap <- papers[papers$Localisation == "Presynaptic",]
mmmpres <- mmpres[mmpres$PaperPMID %in% prespap$PaperPMID,]
table(mmmpres$Npmid)
mmmpres$found <- 0
for(i in 1:dim(mmmpres)[1]) {
    if (mmmpres$Npmid[i] == 1) {
        mmmpres$found[i] <- '1'
    } else if (mmmpres$Npmid[i] > 1 & mmmpres$Npmid[i] < 4) {
        mmmpres$found[i] <- '2-3'
    } else if (mmmpres$Npmid[i] >= 4 & mmmpres$Npmid[i] < 10) {
        mmmpres$found[i] <- '4-9'
    } else if (mmmpres$Npmid[i] >= 10) {
        mmmpres$found[i] <- '>10'
    }
}

mmmpres$found<- factor(mmmpres$found,levels = c('1','2-3','4-9','>10'),ordered=TRUE)
tp<-unique(mmmpres$Paper)
mmmpres$Paper<- factor(mmmpres$Paper,
                       levels =tp[order(as.numeric(sub('^[^0-9]+_([0-9]+)',
                                                      '\\1',tp)))],
                       ordered=TRUE)

#mmmpres$Paper<- factor(mmmpres$Paper,levels = c('BLONDEAU_2004','COUGHENOUR_2004','MORCIANO_2005','PHILLIPS_2005','BURRE_2006','TAKAMORI_2006','ABUL_HUSN_2009','MORCIANO_2009','GORINI_2010','GRONBORG_2010','ABUL_HUSN_2011','BOYKEN_2013','BRINKMALM_2014','WEINGARTEN_2014','WILHELM_2014','KOKOTOS_2018','TAOUFIQ_2020','WITTIG_2021'),ordered=TRUE)
ummpres<-unique(mmmpres[,c('GeneID','Paper','found')])
ggplot(ummpres) + geom_bar(aes(y = Paper, fill = found)) 

```

```{r post_histogram,fig.width=8,fig.height=8}
#postsynaptic stats

pstgp <- gp[gp$Localisation == "Postsynaptic",]
postg <- getGeneInfoByIDs(pstgp$GeneID)
#mpost <- merge(pstgp, postg, by = "GeneID")
mpost <- merge(pstgp, postg, by = c("GeneID","Localisation"))
#mmpost <- mpost[, c(1,3,6, 10, 17, 18, 19)]
mmpost <- mpost[, c('GeneID','HumanEntrez.x','HumanName.x','Npmid','PaperPMID','Paper','Year')]
postspap <- papers[papers$Localisation == "Postsynaptic",]
mmmpost <- mmpost[mmpost$PaperPMID %in% postspap$PaperPMID,]

table(mmmpost$Npmid)
mmmpost$found <- 0
for(i in 1:dim(mmmpost)[1]) {
    if (mmmpost$Npmid[i] == 1) {
        mmmpost$found[i] <- '1'
    } else if (mmmpost$Npmid[i] > 1 & mmmpost$Npmid[i] < 4) {
        mmmpost$found[i] <- '2-3'
    } else if (mmmpost$Npmid[i] >= 4 & mmmpost$Npmid[i] < 10) {
        mmmpost$found[i] <- '4-9'
    } else if (mmmpost$Npmid[i] >= 10) {
        mmmpost$found[i] <- '>10'
    }
}

mmmpost$found<- factor(mmmpost$found,levels = c('1','2-3','4-9','>10'),ordered=TRUE)
tp<-unique(mmmpost$Paper)
mmmpost$Paper<- factor(mmmpost$Paper,
                       levels =tp[order(as.numeric(sub('^[^0-9]+_([0-9]+)',
                                                      '\\1',tp)))],
                       ordered=TRUE)

#mmmpost$Paper<- factor(mmmpost$Paper,levels = c('HUSI_2000','WALIKONIS_2000','SATON_2002','PENG_2002', 'LI_2004','YOSHIMURA_2004','JORDAN_2004', 'FARR_2004','TRINIDAD_2005','DOSEMESI_2006','CHENG_2006','COLLINS_2006','DOSEMESI_2007','TRINIDAD_2008','SELIMI_2009','FERNANDEZ_2009','BAYES_2011','BAYES_2012', 'SCHWENK_2013','DISTLER_2014','BAYES_2014','LI_2016','UEZU_2016','FOCKING_2016','LI_2017','FERNANDEZ_2017','ROY_2017','ROY_2018','WILSON_2019'),ordered=TRUE)
ummpos<-unique(mmmpost[,c('GeneID','Paper','found')])
ggplot(ummpos) + geom_bar(aes(y = Paper, fill = found)) 

```

```{r utot_histogram,fig.width=8,fig.height=4}

#region stats
totg <- getGeneInfoByIDs(gp$GeneID)
#mtot <- merge(gp, totg, by = "GeneID")
mtot <- merge(gp, totg, by = c("GeneID","Localisation"))
#mmptot <- mtot[, c(1,3,6, 9, 10, 18, 21)]
mmptot <- mtot[, c('GeneID','HumanEntrez.x','HumanName.x','Localisation','Npmid','Paper','BrainRegion')]
head(mmptot)
#untot<-unique(mmptot[,c('GeneID','Paper','BrainRegion','Localisation.x')])
untot<-unique(mmptot[,c('GeneID','BrainRegion','Localisation')])
#names(untot)
#names(untot)[4] <- "Localisation"
ggplot(untot) + geom_bar(aes(y = BrainRegion, fill = Localisation)) + scale_fill_manual(values = c("#B99095","#B5E5CF","#FCB5AC", "#B99095"))

ggplot(untot) + geom_bar(aes(y = BrainRegion, fill = Localisation)) + scale_fill_manual(values = c("#3D5B59","#B5E5CF","#FCB5AC", "#B99095"))

```

```{r grouped_histogram,fig.width=8,fig.height=4}
table(untot$Localisation,untot$BrainRegion)-> m
as.data.frame(m)->udf
names(udf)<-c('Localisation','BrainRegion','value')
ggplot(udf, aes(fill=Localisation, y=value, x=BrainRegion)) +
geom_bar(position="dodge", stat="identity")+ scale_fill_manual(values = c("#3D5B59","#B5E5CF","#FCB5AC", "#B99095")) + theme(axis.text.x = element_text(face="plain", color="#993333", angle=45,vjust = 1,hjust=1,size = rel(1.5)))
```

